# 【MB】 **チェックイン**

- ユーザーがQRコードをスキャンして、またバーコードでかざして、Pocketサービスを利用することができます：
    - チェックイン
    - 手ぶら会員オプション
    - 水素水
    - チェックアウト

## **QRコードスキャン** 画面

![nf](image/jp/mb/104check-in/scanQR.png)

### 項目／イベント定義

##### 戻る`ボタン`

- このボタンをタップしたら、 **ホーム**の画面に戻る

##### QRコードスキャンフレーム`フレーム`

- この画面に入ると、QRコードが自動的にスキャンされる
- QRコードを正常に読み取った後、 **サービス利用確認** 画面に移動される。QRコードに応じて異なる画面に移動される。QRコードは４つパータンがあります：
    - 入れ口ーチェックイン
    - 手ぶら
    - 水素水
    - 出口ーチェックアウト

### エラー一覧（Error List）

`None`

## **サービス利用確認 (入れ口)** 画面

![nf](image/jp/mb/104check-in/entry-flow.png)

- 今画面にて、4つパータンが想定される。
    - ケース１：通常
    - ケース２：チェックアウトを問わず、４時間以内再入室
    - ケース３：最終課金。支払う金額が現在利用料金より少ない
    - ケース４：上限料金達成後

### 項目／イベント定義

##### 店舗情報　`区画`

![nf](image/jp/mb/104check-in/current-detail.png)

- API データ
    - `5`：現在利用者数
    - `やや混雑`：現在利用者数に対する混雑状況。まだ設定されない場合は、`未設定`で表示される
    - `300`：現在利用者数に対する利用料金。まだ設定されない場合は、`300円です`の代わりに`未設定`で表示される

##### 入室確認情報　`青い背景区画`

- ケース1- API データ：
    - `松山姫原店`：店舗名
- Aケース2-API データ
    - `松山姫原店`：店舗名
    - `12:32`：支払いして、初回入室時間
    - `16:32`：無料で入室できる最終時間
- ケース3- API データ：
    - `松山姫原店`：店舗名
- ケース4- API データ：
    - `松山姫原店`：店舗名

##### 上限金額情報　`緑背景区画`

- ケース１・２：この区画が表示されない表示されない
- ケース３- API データ：
    - `150`：支払う金額
    - `松山姫原店`：店舗名
- ケース4- API データ：
    - `松山姫原店`：店舗名

##### 入室する`ボタン`

- このボタンをタップしたら、以下の処理順で処理される： 
    - スマートロックが接続を確認する処理。接続されない場合は、 **処理エラー** 画面に移動される。
    - スマートロックの接続が確認出来たら、StripeにAPIを呼び出して、決済する。決済出来ない場合は、 **処理エラー** 画面に移動される。 **ケース２の場合は、決済不要**
    - 決済出来たら、入れ口のスマートロックを解錠する。解錠できたら、 **トレーニングメーニュー作成** 画面に移動される。 **本日のトレーニングメーニュー** ページに参考。
- ユーザーがボタンをタップして、ドアを開けたが、支払う金額が現在のジム利用料金と異なる場合でも、画面に表示されている金額が請求される。

##### 戻る`ボタン`

- このボタンをタップしたら、 **ホーム** の画面に戻る

### エラー一覧（Error List）

`None`

## **処理エラー** 画面

![nf](image/jp/mb/104check-in/error.png)

### 項目／イベント定義

##### 戻る`ボタン`

- このボタンをタップしたら、 **ホーム** の画面に戻る

##### エラーメッセージ　`区画`

![nf](image/jp/mb/104check-in/error-mes.png)

- エラーメッセージが表示する。２つパータンが想定する：
    - スマートロック切断エラー：`内部サーバーエラー`
    - 決済出来ないエラー：APIに返されたエラーメッセージをそのまま表示する

##### 再試行する　`ボタン`

- **サービス利用確認　(入れ口)**　画面の`入室するボタン`と同じ

### エラー一覧（Error List）

#### 画面エラー（Screen Error）

- スマートロック切断エラー：`内部サーバーエラー`
- 決済出来ないエラー：APIに返されたエラーメッセージをそのまま表示する

## **サービス利用確認 (手ぶら)** 画面

![nf](image/jp/mb/104check-in/tebura-flow.png)

- 今画面にて、2つパータンが想定される。
    - ケース１：手ぶら会員オプション契約しているユーザー
    - ケース２：手ぶら会員オプション契約していないユーザー。毎回利用したら、500円がチャージされる。

### 項目／イベント定義

##### 理容料金　`区画`

![nf](image/jp/mb/104check-in/tebura-fee.png)

- ケース２のみ
- API データ
    - `500`：理容料金。入金出来てから４時間以内の場合は、`0`で表示される

##### プラン変更　`ボタン`

![nf](image/jp/mb/104check-in/change-tebura-plan.png)

- ケース２のみ
- このボタンをタップしたら、 **プランの変更** 画面に移動される。 **画面ホーム＆メニュー（Home Menu)** ページ参考。

##### 使用する`ボタン`

- このボタンをタップしたら、以下の処理順で処理される：   
    - スマートロックが接続を確認する処理。接続されない場合は、**処理エラー** 画面に移動される。
    - スマートロックの接続が確認出来たら、StripeにAPIを呼び出して、決済する。決済出来ない場合は、**処理エラー** 画面に移動される。**ケース１の場合は、決済不要**
    - 決済出来たら、手ぶらのスマートロックを解錠する。解錠できたら、解錠済み確認の画面に移動される。

##### 戻る`ボタン`

- このボタンをタップしたら、 **ホーム**の画面に戻る

### エラー一覧（Error List）

`None`

## **サービス利用確認 (水素水)** 画面

![nf](image/jp/mb/104check-in/water-flow.png)

- 今画面にて、2つパータンが想定される。
    - ケース１：水素水オプション契約しているユーザー
    - ケース２：水素水オプション契約していないユーザー。水素水オプション利用できない

### 項目／イベント定義

##### 使用する`ボタン`

- ケース1のみ
- このボタンをタップしたら、以下の処理順で処理される：   
    - 水素デバイスが接続を確認する処理。接続されない場合は、 **処理エラー** 画面に移動される。
    - 水素デバイスの接続が確認出来たら、水素のロックを解除する。ロックが解除できたら、解除できた確認の画面に移動される。

##### 戻る`ボタン`

- このボタンをタップしたら、 **ホーム**の画面に戻る

### エラー一覧（Error List）

`None`

## **サービス利用確認 (出口)** 画面

![nf](image/jp/mb/104check-in/exit-flow.png)

### 項目／イベント定義

##### 使用する`ボタン`

- このボタンをタップしたら、以下の処理順で処理される：   
    - スマートロックが接続を確認する処理。接続されない場合は、 **処理エラー** 画面に移動される。
    - スマートロックの接続が確認出来たら、出口のスマートロックを解錠する。解錠できたら、解錠済み確認の画面に移動される。

##### 戻る`ボタン`

- このボタンをタップしたら、 **ホーム**の画面に戻る

### エラー一覧（Error List）

`None`